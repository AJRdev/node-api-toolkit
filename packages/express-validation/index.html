
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>@ekino/express-validation Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    
    <link rel="prev" href="../express-logger/" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../">
            
                <a href="../../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" >
            
                <span>
            
                    
                    express middlewares
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../express-collection/">
            
                <a href="../express-collection/">
            
                    
                    @ekino/express-collection
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../express-context/">
            
                <a href="../express-context/">
            
                    
                    @ekino/express-context
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="../express-logger/">
            
                <a href="../express-logger/">
            
                    
                    @ekino/express-logger
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.2.4" data-path="./">
            
                <a href="./">
            
                    
                    @ekino/express-validation
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" >
            
                <span>
            
                    
                    core
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../api-toolkit-validation/">
            
                <a href="../api-toolkit-validation/">
            
                    
                    @ekino/api-toolkit-validation
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../../CONTRIBUTING.html">
            
                <a href="../../CONTRIBUTING.html">
            
                    
                    contributing
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../.." >@ekino/express-validation</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="ekinoexpress-validation">@ekino/express-validation</h1>
<p><a href="https://www.npmjs.com/package/@ekino/express-validation" target="_blank"><img src="https://img.shields.io/npm/v/@ekino/express-validation.svg?style=flat-square" alt="version"></a></p>
<p>:warning: Work in progress :warning:</p>
<p>This package helps validating/normalizing incoming express API requests
using <a href="https://github.com/hapijs/joi" target="_blank">Joi</a> schemas in the form of express middlewares.
When you add one of the provided middelwares to your app, it will try to validate
the given source (body, path, query, headers) against a Joi schema,
replace the source data with the validated data if validation passes
or send back the validation errors along with a <code>400</code> HTTP status code otherwise.</p>
<blockquote>
<p>Please be aware that the provided middlewares mutate the request&apos;s source data.</p>
</blockquote>
<p>It can be used for several purposes, for example:</p>
<ul>
<li>validating payload when attempting to write to your API</li>
<li>validating pagination/filters/sorting when retrieving a list of items</li>
<li>validating path parameters such as ids</li>
<li>validating tokens present in request headers (not the fact that they actually exists)</li>
</ul>
<p>It&apos;s written in TypeScript, so there&apos;s no need to install external types
if you&apos;re working on a TypeScript based project.
However TypeScript is not required as the published package contains
a compiled version.</p>
<p>It supports several <em>sources</em>:</p>
<ul>
<li><a href="#validating-request-body">request body</a></li>
<li><a href="#validating-request-path">request path</a></li>
<li><a href="#validating-request-query">request query</a></li>
<li><a href="#validating-request-headers">request headers</a></li>
</ul>
<p>You can easily adapt it to your needs using the <a href="#configuration">configuration object</a>.</p>
<h2 id="installation">Installation</h2>
<p>You also have to install <a href="https://github.com/hapijs/joi" target="_blank">Joi</a> as it&apos;s a peer dependency
of this package.</p>
<pre><code class="lang-sh">yarn add joi @ekino/express-validation
</code></pre>
<h2 id="usage">Usage</h2>
<h3 id="validating-request-body">Validating request body</h3>
<pre><code class="lang-typescript"><span class="hljs-keyword">import</span> * as Joi from <span class="hljs-string">&apos;joi&apos;</span>
<span class="hljs-keyword">import</span> { validateRequestBody } from <span class="hljs-string">&apos;@ekino/express-validation&apos;</span>

app.post(<span class="hljs-string">&apos;/post&apos;</span>, validateRequestBody(schema), (req, res) =&gt; {})
</code></pre>
<h3 id="validating-request-path">Validating request path</h3>
<pre><code class="lang-typescript"><span class="hljs-keyword">import</span> * as Joi from <span class="hljs-string">&apos;joi&apos;</span>
<span class="hljs-keyword">import</span> { validateRequestPath } from <span class="hljs-string">&apos;@ekino/express-validation&apos;</span>

<span class="hljs-keyword">const</span> schema = Joi.object().keys({
    id: Joi.number().required()
})

app.get(<span class="hljs-string">&apos;/post/:id&apos;</span>, validateRequestPath(schema), (req, res) =&gt; {
    <span class="hljs-comment">// now you&apos;re sure that `id` is a number,</span>
    <span class="hljs-comment">// it also have been casted to a number</span>
    <span class="hljs-keyword">const</span> { id } = req.params
})
</code></pre>
<h3 id="validating-request-query">Validating request query</h3>
<pre><code class="lang-typescript"><span class="hljs-keyword">import</span> * as Joi from <span class="hljs-string">&apos;joi&apos;</span>
<span class="hljs-keyword">import</span> { validateRequestQuery } from <span class="hljs-string">&apos;@ekino/express-validation&apos;</span>

<span class="hljs-keyword">const</span> schema = Joi.object().keys({
    sort: Joi.string().required()
})

app.get(<span class="hljs-string">&apos;/posts&apos;</span>, validateRequestQuery(schema), (req, res) =&gt; {
    <span class="hljs-comment">// assuming you made a request such as `GET /posts?sort=title`</span>
    <span class="hljs-comment">// now you&apos;re sure that `sort` exists</span>
    <span class="hljs-keyword">const</span> { sort } = req.query
})
</code></pre>
<h3 id="validating-request-headers">Validating request headers</h3>
<pre><code class="lang-typescript"><span class="hljs-keyword">import</span> * as Joi from <span class="hljs-string">&apos;joi&apos;</span>
<span class="hljs-keyword">import</span> { validateRequestHeaders } from <span class="hljs-string">&apos;@ekino/express-validation&apos;</span>

app.get(<span class="hljs-string">&apos;/posts&apos;</span>, validateRequestHeaders(), (req, res) =&gt; {})
</code></pre>
<h2 id="configuration">Configuration</h2>
<p>You can completely customize the behaviour of the middlewares,
this module can act as a simple bridge between Joi &amp; express.</p>
<p>The available options are:</p>
<ul>
<li>joiOptions</li>
<li>logger</li>
<li>errorStatusCode</li>
<li>errorBody</li>
<li>errorHandler</li>
</ul>
<p>Let&apos;s now see which use cases can be covered using those options.</p>
<h3 id="customizing-joi-options">Customizing Joi options</h3>
<h3 id="adding-logging-support">Adding logging support</h3>
<h3 id="customizing-error-response-status-code">Customizing error response status code</h3>
<p>By default, all the middlewares issue a <code>400</code> HTTP status code,
the <code>errorStatusCode</code> option allows you to use another one.</p>
<pre><code class="lang-typescript">app.get(<span class="hljs-string">&apos;/post/:id&apos;</span>, validateRequestPath(schema, { errorStatusCode: <span class="hljs-number">404</span> }), (req, res) =&gt; {
    <span class="hljs-comment">// ...</span>
})
</code></pre>
<p>Now, if the provided <code>:id</code> doesn&apos;t conform to <code>schema</code>, the client will receive a <code>404</code> HTTP status code.</p>
<p>You can also use a function to determine response status code, which can be useful
if you have to add some extra logic to define it.</p>
<pre><code class="lang-typescript">app.get(
    <span class="hljs-string">&apos;/post/:id&apos;</span>,
    validateRequestPath(schema, {
        errorStatusCode: (req: Request, error: ValidationError) =&gt; <span class="hljs-number">401</span>
    }),
    (req, res) =&gt; {
        <span class="hljs-comment">/* ... */</span>
    }
)
</code></pre>
<h3 id="customizing-error-response-body">Customizing error response body</h3>
<h3 id="using-your-own-error-handler">Using your own error handler</h3>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="../express-logger/" class="navigation navigation-prev navigation-unique" aria-label="Previous page: @ekino/express-logger">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"@ekino/express-validation","level":"1.2.4","depth":2,"next":{"title":"core","level":"1.3","depth":1,"ref":"","articles":[{"title":"@ekino/api-toolkit-validation","level":"1.3.1","depth":2,"path":"packages/api-toolkit-validation/README.md","ref":"packages/api-toolkit-validation/README.md","articles":[]}]},"previous":{"title":"@ekino/express-logger","level":"1.2.3","depth":2,"path":"packages/express-logger/README.md","ref":"packages/express-logger/README.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":[],"pluginsConfig":{"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"packages/express-validation/README.md","mtime":"2019-02-17T15:56:14.734Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2019-02-17T17:02:17.538Z"},"basePath":"../..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="../../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

